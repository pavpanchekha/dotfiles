#!/bin/bash

usage() {
    echo "View and add to your calendar"
    echo
    echo "USAGE: event                      Show calendar"
    echo "     | event <date> <event>       Add <event> at <date>"
    echo "     | event <d> <m> <event>      Add <event> at <m>/<d>"
    echo "     | event <d> <m> <y> <event>  Add <event> at <m>/<d>/<y>"
}

num2date () {
    sed 's_^01/_Jan _' | sed 's_^02/_Feb _' | sed 's_^03/_Mar _' |
        sed 's_^04/_Apr _' | sed 's_^05/_May _' | sed 's_^06/_Jun _' |
        sed 's_^07/_Jul _' | sed 's_^08/_Aug _' | sed 's_^09/_Sep _' |
        sed 's_^10/_Oct _' | sed 's_^11/_Nov _' | sed 's_^12/_Dec _'
}

kill-past-today () {
    YEAR=`date +%Y`
    MONTH=`date +%m`
    DAY=`date +%d`
    sed -r 's_([0-9/]+)_\1/_' | awk -F/ "
(\$1 >= $YEAR) && (\$2 >= $MONTH) && (\$3 >= $DAY) {
    print
}
"
}

if [[ $1 == "-h" ]]; then
    usage
elif [[ $# -eq 0 ]]; then
    cd ~/calendar && remind -s+2 active | sort -n | kill-past-today | sed 's/ \* \* \* \*/  /g' | sed -r 's_[0-9]+/([0-9]+)/([0-9]+)/_\1/\2_g' | num2date

elif [[ $# -eq 2 ]]; then
    echo -e "REM $1\tMSG $2" >> ~/calendar/active
elif [[ $# -eq 3 ]]; then
    echo -e "REM $1 $2\tMSG $3" >> ~/calendar/active
elif [[ $# -eq 4 ]]; then
    echo -e "REM $1 $2 $3\tMSG $4" >> ~/calendar/active
else
    usage
fi
